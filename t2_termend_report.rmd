---
title: "応用計量分析1　期末課題　レポート"
author: "岡本 夏旺"
output: 
  html_document:
    toc: TRUE
    number_section: TRUE
---

```{r include = FALSE}
#チャンク設定：#出力方法を調整できる
#ここは特に変更する必要はなし
knitr::opts_chunk$set(out.width = "100%", fig.align = "center")
```

<div hidden>
```{r child = "t2_termend_code.Rmd", include = FALSE}

```
</div>



# はじめに
今回は東京都と大阪府の地図をプロットする。
![コロナウイルス１週間あたり](184841.jpg)




理由:8/27日現在
直近1週間の人口10万人あたりの感染者数が東京都、大阪府が2,3番目に多かったため。1番多い沖縄県に関しては本州から離れており、今回は普遍的なコロナ感染者の拡大の理由について考えたかったので沖縄県は省いた。

東京都区市町村別の新型コロナウイルスの陽性患者数（累計）を描写する.(8/27)
```{r, ref.label= "visualize_map1"}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
```

東京都区市町村別の居住者人口10万人あたりの陽性患者数（累計）を描写する。(8/27)
```{r, ref.label= "visualize_map2"}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
```

大阪府市町村別の新型コロナウイルスの陽性患者数（累計）を描写する.(8/27)
```{r, ref.label= "visualize_map3"}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
```


大阪府市町村別の居住者人口10万人あたりの陽性患者数（累計）を描写する。(8/27)
```{r, ref.label= "visualize_map4"}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
```

以上の地図を見てみると東京都と大阪府どちらも都心部において陽性患者数が多いことがわかる。<br>
そのため都心部に人々が訪れることが原因で(会社への通勤や飲食店や娯楽施設へ行くことなど)コロナウイルの感染拡大につながっているのではないかと考えられる。<br>
だが、以下の記事を見ると通勤電車でのコロナへの感染は換気することで抑えられる事がわかる。<br>
https://www.fnn.jp/articles/-/71584
<br>
コロナ期間中の駅利用状況推移は以下のグラフのようになっている。<br>
https://www.mlit.go.jp/tetudo/tetudo_fr1_000062.html <br>
![電車](001350659-1 (6).png)



<br>
このグラフからコロナ期間中は乗客率は普段と比べかなり下がっており、上記の記事でいう閑散時に近い状況であることがわかり、電車通勤中のコロナウイルス感染拡大は抑えられているのではないかと考えられる。実際調べてみると居酒屋などのお店でのクラスター感染の記事は見つかるが、電車通勤中のクラスター感染の記事は見つからなかった。もしかしたら感染経路不明と片付けられているかもしれいが、通勤途中のクラスター感染する確率は低いと考る。<br>

そのため今回は会社への通勤途中に感染するよりも飲食店や娯楽施設などへ行くことでコロナウイルが感染拡大しているのではないかと考える。<br>
その中でも若者がよく飲食店や娯楽施設などへ行くことが多いと思い、年齢別のコロナウイルス陽性者数を調べてみると東京都のみになってしまうのですが、以下のサイトから<br>
https://www3.nhk.or.jp/news/special/coronavirus/by-age-tokyo/　<br>

![年齢別割合](184810.jpg)
<br>
20代の感染率がやはり高いことがわかる。<br>
このことから今回は20代の若者が飲食店や娯楽施設などへ行くために移動することでコロナウイルス感染拡大が起きているのではないかと仮定する。


# 分析方法
今回は宿泊業，飲食サービス業と生活関連サービス業，娯楽業についてheatmap分析を行いクラスターを抽出し、それぞれのheatmapと市町村別の居住者人口10万人あたりの陽性患者数（累計）を照らし合わせ、クラスターが多く陽性患者数が多い地域に対しての年齢別の移動人数を割り出す。このように分析することで20代がその地域に行く割合が他の年代よりも多かった場合、因果関係とは言えないが少なからず何かしら関係があるのではないかと考えられる。<br>
heatmap分析ではGetis-Ord G*i(d)統計量を用いることで分析している。<br>
Getis-Ord G*i(d)統計量は以下の式で求めている。<br>
$G^{*}_{i}(d)=\Sigma^{n}_{j = 1} w_{ij}(d)x_{j}/\Sigma^{n}_{j=1}x_{j}$<br>
$w_{ij}$は空間重み行列の各要素を表し、$x_{j}$は地点jで観測される変数を表し$n,d$はそれぞれ総地点数、距離の閾値を表す。

# データ
データの出どころ<br>
今回heatmap分析をする際にはメッシュ境界データとメッシュ統計データを https://www.e-stat.go.jp/ サイトからwebapiを用いて、ダウンロードし東京都と大阪府にあたる１次メッシュ5338,5339と１次メッシュ5135,5235用いた。<br>
またheatmap分析で同時に描写した東京都区市町村別の新型コロナウイルスの陽性患者数データは https://github.com/tokyo-metropolitan-gov/covid19/blob/development/data/patient.json からjson形式でダウンロードした。<br>
大阪府の新型コロナウイルスの陽性患者数データは http://www.pref.osaka.lg.jp/attach/23711/00346644/youseisyajyouhou.xls
からxls形式でダウンロードした。<br>
移動データに関しては https://opendata.resas-portal.go.jp/docs/api/v1/partner/docomo/destination.html からwebapiの使用法に従い、滞在先が渋谷区、港区、新宿区、千代田区、中央区、台東区、大阪市のデータをjson形式でダウンロードした。（細かい設定としてはyear:2016,month:4月,periodOfDay:平日,periodOfTime:20時gender:指定なし,ageRange:指定なし　とした）

変数<br>
heatmapで用いているGetis-Ord G*i(d)は有意水準1％,5％に合わして定義されている。<br>
heatmapとともに描写されている東京都区市町村別の居住者人口10万人あたりの陽性患者数（累計）はpatients_100000として６つの地域に分かれるように描写されている。<br>



年齢別の移動データの棒グラフに関しては、agesは年齢層で分類していることを表す。age15:15〜19歳,age20:20〜29歳,age30:30〜39歳,age40:40〜49歳,age50:50〜59歳,age60:60〜69歳,age70:70〜79歳を表す。<br>
countはそれぞれの市区町村に滞在した人の人数を表す。またグラフのタイトルが滞在先を表す。


# 分析結果・考察
東京都の地図の可視化(宿泊業，飲食サービス業についてのheatmap)
先程の東京都区市町村別の（2）居住者人口10万人あたりの陽性患者数（累計）も同時に描写する
```{r, ref.label= "visualize_map5", echo = FALSE}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
#必要なければこのコードチャンクは削除してください。
```



東京都の地図の可視化(生活関連サービス業，娯楽業についてのheatmap)
先程の東京都区市町村別の（2）居住者人口10万人あたりの陽性患者数（累計）も同時に描写する
```{r, ref.label= "visualize_map6", echo = FALSE}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
#必要なければこのコードチャンクは削除してください。
```



大阪府の地図の可視化(宿泊業，飲食サービス業についてのheatmap)
大阪府市町村別の（2）居住者人口10万人あたりの陽性患者数（累計）も同時に描写する。
```{r, ref.label= "visualize_map7", echo = FALSE}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
#必要なければこのコードチャンクは削除してください。
```



大阪府の地図の可視化(生活関連サービス業，娯楽業についてのheatmap)
大阪府市町村別の（2）居住者人口10万人あたりの陽性患者数（累計）も同時に描写する。
```{r, ref.label= "visualize_map8", echo = FALSE}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
#必要なければこのコードチャンクは削除してください。
```
以上の地図からところどころクラスターになっているところは存在するが、宿泊業，飲食サービス業や生活関連サービス業，娯楽業においてどちらの地図でも東京都では主に渋谷区、港区、新宿区、千代田区、中央区、台東区が挙げられ、大阪府では大阪市が挙げられる。<br>
上記で挙げた市区町村は居住者人口10万人あたりの陽性患者数を描写した際も割合が比較的多い市区町村である。このことから宿泊業，飲食サービス業や生活関連サービス業，娯楽業が多い地域ではコロナ感染者数が多いと言えそうである。だがその逆は特に大阪府の地図を見ると常に成り立つとは言えなそうである。そのためコロナウイルス感染拡大の説明として絶対的とは言えないが、一つの要素として宿泊業，飲食サービス業や生活関連サービス業，娯楽業が密集している地域ではコロナウイルスの感染拡大が起きたと言えるのではないか。<br>





年齢層別に渋谷区、港区、新宿区、千代田区、中央区、台東区に滞在していた人の総人数の可視化
```{r, ref.label= "visualize_map9", echo = FALSE}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
#必要なければこのコードチャンクは削除してください。
```


年齢層別に大阪市に滞在していた人の総人数の可視化
```{r, ref.label= "visualize_map10", echo = FALSE}
#ここから分析コードのR Markdown内にある指定したチャンクを呼び出します。
#分析コード側にある図表や分析結果を呼び出したいチャンクにが名前をつけてください。
#必要なければこのコードチャンクは削除してください。
```

このグラフからは新宿区を除くすべての市、区において30代の人々が一番滞在していることがわかる。
また2番目に多いのが20代または40代であることがわかる。
今回は20代の若者が飲食店や娯楽施設などへ行くために移動することでコロナウイルス感染拡大が起きているのではないかと仮定したいたが、グラフでは30代が一番多かったため今回の仮定は成り立たなくなった。



# 結論
今回の分析では自分の立てた仮説どおりの結果はえられなかった。
分析をする上でデータの収集がかなり大切であると学んだ。移動データとして2016年4月のデータを用いたのでこのように30代が一番多い言う結果になったが、2020年現在のデータを用いたら違う結果が得られたのかもしれない。またもし今回の分析の流れで年齢層別の滞在人数が一番20代が多かったとしても、直接的にはコロナウイル背感染拡大の理由であるとは言えないため、千代田区の年齢層別の飲食店や娯楽施設に訪れた人数や千代田区の陽性患者の年齢層データなどが手に入ればより今回私がたてた仮説を検証する上でより厳密に吟味できたのかもしれないと思った。




# 参考文献
https://www3.nhk.or.jp/news/special/coronavirus/data/ <br>
https://www.fnn.jp/articles/-/71584 <br>
https://www.mlit.go.jp/tetudo/tetudo_fr1_000062.html <br>
https://www3.nhk.or.jp/news/special/coronavirus/by-age-tokyo/ <br>

