"0","fAggregateShapefile <- function(x) {"
"0","  #シェープファイルを読み込む"
"0","  sf <- sf::read_sf(paste0(""data_estat/h27ka"", x, "".shp""))"
"0","  "
"0","  #一時作業用"
"0","  #不要なポリゴンを削除"
"0","  sfTemp <- sf %>%"
"0","    dplyr::mutate(prefCode = as.numeric(PREF)) %>%"
"0","    dplyr::mutate(prefName = as.character(PREF_NAME)) %>%"
"0","    dplyr::mutate(cityCode = as.numeric(paste0(PREF, CITY))) %>%"
"0","    dplyr::mutate(cityName = as.character(CITY_NAME)) %>%"
"0","    dplyr::filter(HCODE != 8154) %>%"
"0","    dplyr::select(KEY_CODE,prefCode, prefName, cityCode, cityName, JINKO, geometry)"
"0","  "
"0","  #例外処理"
"0","  #東京都の島嶼を除く"
"0","  #qgisを用いて大阪負を適切な範囲に絞る。"
"0","  if(x == 13) {"
"0","    sfTemp <- sfTemp %>%"
"0","      dplyr::filter(cityCode > 13100 & cityCode < 13360)"
"0","  } else if(x == 27) {"
"0","    sfTemp <- sfTemp %>% "
"0","      dplyr::filter(KEY_CODE != 271131000) %>% "
"0","      dplyr::filter(KEY_CODE != 271041000) %>% "
"0","      dplyr::filter(KEY_CODE != 271071000) %>% "
"0","      dplyr::filter(KEY_CODE != 271081000) %>%     "
"0","      dplyr::filter(KEY_CODE != 271419990) %>%       "
"0","      dplyr::filter(KEY_CODE != 271449990) %>%"
"0","      dplyr::filter(KEY_CODE != 272250130) %>% "
"0","      dplyr::filter(KEY_CODE != 272060560) %>%"
"0","      dplyr::filter(KEY_CODE != 273410100) %>%"
"0","      dplyr::filter(KEY_CODE != 272020200) %>%"
"0","      dplyr::filter(KEY_CODE != 272080990)"
"0","  }"
"0","  "
"0","  #ポリゴンを区市町村単位に集計"
"0","  #大阪府のコロナ感染者のデータでは市までの情報しかなく、どこの区在住の方かわからないので東京都の処理と場合分けをする必要がある。"
"0","  if(x == 13){"
"0","    sfTempCity <- sfTemp %>%"
"0","      dplyr::group_by(cityCode) %>% "
"0","      dplyr::summarise("
"0","      prefCode = first(prefCode),"
"0","      prefName = first(prefName),"
"0","      cityName = first(cityName),"
"0","      pop = sum(JINKO)"
"0","    ) "
"0","  } else if(x == 27){"
"0","    #大阪市と堺市に属する区のcityNameを大阪市と堺市に変更する。"
"0","    sfTempCity <- sfTemp %>%"
"0","      dplyr::mutate(cityName = if_else((27101<cityCode)&(cityCode<27129),'大阪市',cityName)) %>%"
"0","      dplyr::mutate(cityName = if_else((27140<cityCode)&(cityCode<27148),'堺市',cityName)) %>% "
"0","      dplyr::group_by(cityName) %>% "
"0","      dplyr::summarise("
"0","      prefCode = first(prefCode),"
"0","      prefName = first(prefName),"
"0","      cityName = first(cityName),"
"0","      pop = sum(JINKO)"
"0","    )"
"0"," }"
"0","    "
"0","  #作成したデータフレームを返す"
"0","  return(sfTempCity)"
"0","}"
